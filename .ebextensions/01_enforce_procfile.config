option_settings:
  aws:elasticbeanstalk:application:environment:
    PORT: "5000"
    SERVER_PORT: "5000"
    _JAVA_OPTIONS: "-Dserver.port=5000 -Dspring.profiles.active=aws"
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: "true"

files:
  "/var/app/staging/Procfile":
    mode: "000644"
    owner: root
    group: root
    content: |
      web: java -Dserver.port=5000 -jar target/credit_score_sys-0.0.1-SNAPSHOT.jar

commands:
  001_create_eb_extensions_dir:
    command: "mkdir -p /var/app/staging/.ebextensions"
    ignoreErrors: true
  
  002_force_procfile_early:
    command: |
      cat > /var/app/staging/Procfile << 'EOF'
      web: java -Dserver.port=5000 -jar target/credit_score_sys-0.0.1-SNAPSHOT.jar
      EOF
    leader_only: false

container_commands:
  001_verify_procfile_after_deploy:
    command: "cat /var/app/current/Procfile && echo 'Procfile verified'"
    leader_only: false
